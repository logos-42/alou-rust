# Alou Rust - è‡ªåŠ¨åŒ–å·¥ä½œæµæ™ºèƒ½ä½“

ä¸€ä¸ªåŸºäºRustå’ŒModel Context Protocol (MCP)çš„æ™ºèƒ½è‡ªåŠ¨åŒ–å·¥ä½œæµç³»ç»Ÿï¼Œé›†æˆäº†DeepSeek APIï¼Œæä¾›å¼ºå¤§çš„ä¸Šä¸‹æ–‡æ„ŸçŸ¥å’Œå·¥å…·è°ƒç”¨èƒ½åŠ›ã€‚

## âœ¨ æœ€æ–°æ›´æ–°

- **âœ… å·¥å…·è°ƒç”¨ä¿®å¤**ï¼šå®Œå…¨ä¿®å¤äº†æ™ºèƒ½ä½“å·¥å…·è°ƒç”¨è§£æå’Œæ‰§è¡Œé€»è¾‘
- **âœ… åå°åŠ è½½ä¼˜åŒ–**ï¼šå®ç°äº†é™é»˜çš„åå°MCPæœåŠ¡å™¨åŠ è½½ï¼Œæå‡å¯åŠ¨é€Ÿåº¦
- **âœ… Windowså…¼å®¹æ€§**ï¼šä¼˜åŒ–äº†Windowsç³»ç»Ÿä¸‹çš„MCPæœåŠ¡å™¨é…ç½®
- **âœ… æ™ºèƒ½ç›®å½•è®¿é—®**ï¼šæ”¯æŒå¤šç›®å½•é…ç½®å’Œæ™ºèƒ½è·¯å¾„è§£æ

## ğŸš€ æ ¸å¿ƒç‰¹æ€§

### æ™ºèƒ½ä½“æ¶æ„
- **å¤šæ¨¡æ€æ™ºèƒ½ä½“**ï¼šæ”¯æŒæ–‡ä»¶æ“ä½œã€ç½‘ç»œè¯·æ±‚ã€è®°å¿†ç®¡ç†ç­‰å¤šç§å·¥å…·
- **ä¸Šä¸‹æ–‡æ„ŸçŸ¥**ï¼šæ™ºèƒ½å·¥ä½œåŒºæ£€æµ‹ï¼Œè‡ªåŠ¨è¯†åˆ«é¡¹ç›®ç»“æ„å’Œç¯å¢ƒ
- **å·¥å…·å‘ç°**ï¼šè‡ªåŠ¨å‘ç°å’Œé›†æˆMCPæœåŠ¡å™¨æä¾›çš„å·¥å…·
- **è¿æ¥æ± ç®¡ç†**ï¼šé«˜æ•ˆçš„MCPæœåŠ¡å™¨è¿æ¥æ± ï¼Œæ”¯æŒå¤šæœåŠ¡å™¨å¹¶å‘
- **åå°åŠ è½½**ï¼šé™é»˜çš„åå°MCPæœåŠ¡å™¨åŠ è½½ï¼Œæå‡ç”¨æˆ·ä½“éªŒ
- **æ™ºèƒ½å·¥å…·è°ƒç”¨**ï¼šå®Œæ•´çš„å·¥å…·è°ƒç”¨è§£æå’Œæ‰§è¡Œæœºåˆ¶

### DeepSeeké›†æˆ
- **APIå®¢æˆ·ç«¯**ï¼šå®Œæ•´çš„DeepSeek APIé›†æˆ
- **æ™ºèƒ½æç¤º**ï¼šåŸºäºå·¥ä½œåŒºä¸Šä¸‹æ–‡çš„åŠ¨æ€ç³»ç»Ÿæç¤ºç”Ÿæˆ
- **å¯¹è¯ç®¡ç†**ï¼šæ”¯æŒå¤šè½®å¯¹è¯å’Œä¸Šä¸‹æ–‡ä¿æŒ
- **å·¥å…·è°ƒç”¨**ï¼šAIé©±åŠ¨çš„æ™ºèƒ½å·¥å…·é€‰æ‹©å’Œå‚æ•°ç”Ÿæˆ
- **å“åº”è§£æ**ï¼šè‡ªåŠ¨è§£æDeepSeekå“åº”ä¸­çš„å·¥å…·è°ƒç”¨
- **é”™è¯¯å¤„ç†**ï¼šæ™ºèƒ½çš„é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶

### å·¥ä½œæµè‡ªåŠ¨åŒ–
- **ä»»åŠ¡åˆ†è§£**ï¼šè‡ªåŠ¨å°†å¤æ‚ä»»åŠ¡åˆ†è§£ä¸ºå¯æ‰§è¡Œæ­¥éª¤
- **å¹¶è¡Œæ‰§è¡Œ**ï¼šæ”¯æŒå¤šå·¥å…·å¹¶è¡Œè°ƒç”¨
- **é”™è¯¯æ¢å¤**ï¼šæ™ºèƒ½é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶
- **çŠ¶æ€ç®¡ç†**ï¼šå®Œæ•´çš„æ™ºèƒ½ä½“çŠ¶æ€è·Ÿè¸ªå’Œæ¢å¤

## ğŸ—ï¸ æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   DeepSeek API  â”‚    â”‚   MCP Agent      â”‚    â”‚  MCP Servers    â”‚
â”‚                 â”‚â—„â”€â”€â–ºâ”‚                  â”‚â—„â”€â”€â–ºâ”‚                 â”‚
â”‚ â€¢ Chat API      â”‚    â”‚ â€¢ Context Mgmt   â”‚    â”‚ â€¢ Filesystem    â”‚
â”‚ â€¢ Tool Calling  â”‚    â”‚ â€¢ Tool Discovery â”‚    â”‚ â€¢ Memory        â”‚
â”‚ â€¢ Streaming     â”‚    â”‚ â€¢ Workflow Exec  â”‚    â”‚ â€¢ Network       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚  Connection Pool â”‚
                       â”‚                  â”‚
                       â”‚ â€¢ Multi-server   â”‚
                       â”‚ â€¢ Health Check   â”‚
                       â”‚ â€¢ Auto-reconnect â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“¦ æ ¸å¿ƒç»„ä»¶

### æ™ºèƒ½ä½“ (Agent)
```rust
use mcp_client_rs::agent::{McpAgent, AgentConfig, DeepSeekConfig};

let config = AgentConfig {
    deepseek: DeepSeekConfig {
        base_url: "https://api.deepseek.com".to_string(),
        api_key: "your-api-key".to_string(),
        model: "deepseek-chat".to_string(),
        max_tokens: 4000,
        temperature: 0.7,
    },
    behavior: BehaviorConfig {
        max_retries: 3,
        timeout_seconds: 30,
        verbose_logging: true,
        tool_strategy: ToolStrategy::Auto,
    },
    workspace: WorkspaceConfig {
        directories: vec![".".to_string()],
        smart_detection: true,
        exclude_patterns: vec!["target".to_string()],
    },
};

let mut agent = McpAgent::new(config).await?;
agent.initialize().await?;
let response = agent.process_input("åˆ†æå½“å‰é¡¹ç›®ç»“æ„å¹¶ç”ŸæˆæŠ¥å‘Š").await?;
```

### è¿æ¥æ±  (ConnectionPool)
```rust
use mcp_client_rs::connection_pool::{ConnectionPool, McpServerConfig};

let pool = ConnectionPool::new();

// æ³¨å†ŒMCPæœåŠ¡å™¨
pool.register_server("filesystem".to_string(), McpServerConfig {
    command: "uvx".to_string(),
    args: vec!["mcp-server-filesystem".to_string()],
    directory: Some(".".to_string()),
    env: None,
}).await;

// è·å–è¿æ¥
let client = pool.get_connection("filesystem").await?;
```

### å·¥ä½œåŒºä¸Šä¸‹æ–‡ (WorkspaceContext)
```rust
use mcp_client_rs::workspace_context::WorkspaceContextFactory;

// æ™ºèƒ½æ£€æµ‹å·¥ä½œåŒº
let context = WorkspaceContextFactory::create_smart();

// è‡ªå®šä¹‰å·¥ä½œåŒº
let context = WorkspaceContextFactory::create_custom(vec![
    PathBuf::from("/path/to/project1"),
    PathBuf::from("/path/to/project2"),
]);
```

## ğŸ› ï¸ ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬ä½¿ç”¨
```rust
use mcp_client_rs::agent::{McpAgent, AgentConfig, DeepSeekConfig, BehaviorConfig, WorkspaceConfig, ToolStrategy};

#[tokio::main]
async fn main() -> Result<(), Box<dyn std::error::Error>> {
    // åˆå§‹åŒ–æ—¥å¿—
    tracing_subscriber::fmt::init();
    
    // åˆ›å»ºæ™ºèƒ½ä½“é…ç½®
    let config = AgentConfig {
        deepseek: DeepSeekConfig {
            base_url: "https://api.deepseek.com".to_string(),
            api_key: std::env::var("DEEPSEEK_API_KEY")?,
            model: "deepseek-chat".to_string(),
            max_tokens: 4000,
            temperature: 0.7,
        },
        behavior: BehaviorConfig {
            max_retries: 3,
            timeout_seconds: 30,
            verbose_logging: true,
            tool_strategy: ToolStrategy::Auto,
        },
        workspace: WorkspaceConfig {
            directories: vec![".".to_string()],
            smart_detection: true,
            exclude_patterns: vec!["target".to_string(), "node_modules".to_string()],
        },
    };
    
    // åˆ›å»ºå¹¶åˆå§‹åŒ–æ™ºèƒ½ä½“
    let mut agent = McpAgent::new(config).await?;
    agent.initialize().await?;
    
    // å¤„ç†ç”¨æˆ·è¾“å…¥
    let response = agent.process_input("å¸®æˆ‘åˆ†æè¿™ä¸ªRusté¡¹ç›®çš„ä»£ç ç»“æ„").await?;
    println!("æ™ºèƒ½ä½“å“åº”: {}", response);
    
    Ok(())
}
```

### é«˜çº§é…ç½®
```rust
// è‡ªå®šä¹‰å·¥å…·ç­–ç•¥
let config = AgentConfig {
    // ... å…¶ä»–é…ç½®
    behavior: BehaviorConfig {
        tool_strategy: ToolStrategy::Priority(vec![
            "filesystem".to_string(),
            "memory".to_string(),
            "network".to_string(),
        ]),
        // ... å…¶ä»–é…ç½®
    },
    // ... å…¶ä»–é…ç½®
};
```

## ğŸ”§ ç¯å¢ƒé…ç½®

### ç¯å¢ƒå˜é‡
```bash
# DeepSeek APIé…ç½®
export DEEPSEEK_API_KEY="your-api-key-here"
export DEEPSEEK_BASE_URL="https://api.deepseek.com"  # å¯é€‰ï¼Œé»˜è®¤å€¼

# å·¥ä½œåŒºé…ç½®
export ALOU_WORKSPACE_DIRS="/path/to/project1,/path/to/project2"  # å¯é€‰

# æ—¥å¿—é…ç½®
export RUST_LOG="info"  # debug, info, warn, error
```

### MCPæœåŠ¡å™¨é…ç½®
åˆ›å»º `mcp.json` é…ç½®æ–‡ä»¶ï¼š

#### Linux/macOS é…ç½®
```json
{
  "mcpServers": {
    "filesystem": {
      "command": "npx",
      "args": [
        "-y",
        "@modelcontextprotocol/server-filesystem",
        "/path/to/allowed/directory"
      ]
    },
    "memory": {
      "command": "npx",
      "args": [
        "-y",
        "@modelcontextprotocol/server-memory"
      ]
    }
  }
}
```

#### Windows é…ç½®
```json
{
  "mcpServers": {
    "filesystem": {
      "command": "npx.cmd",
      "args": [
        "-y",
        "@modelcontextprotocol/server-filesystem",
        "C:\\",
        "D:\\",
        "E:\\"
      ]
    },
    "memory": {
      "command": "npx.cmd",
      "args": [
        "-y",
        "@modelcontextprotocol/server-memory"
      ]
    }
  }
}
```

> **æ³¨æ„**ï¼šWindows ç³»ç»Ÿéœ€è¦ä½¿ç”¨ `npx.cmd` è€Œä¸æ˜¯ `npx`ï¼Œè¿™æ˜¯å› ä¸º Windows ä¸Šçš„ `npx` æ˜¯ PowerShell è„šæœ¬ï¼Œè€Œ MCP æœåŠ¡å™¨éœ€è¦ç›´æ¥å¯æ‰§è¡Œçš„æ‰¹å¤„ç†æ–‡ä»¶ã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

1. **å…‹éš†é¡¹ç›®**
```bash
git clone https://github.com/your-username/alou-rust.git
cd alou-rust
```

2. **å®‰è£…ä¾èµ–**
```bash
cargo build
```

3. **é…ç½®ç¯å¢ƒ**
```bash
export DEEPSEEK_API_KEY="your-api-key"
```

4. **è¿è¡Œç¤ºä¾‹**
```bash
# äº¤äº’å¼èŠå¤©æ¨¡å¼
cargo run --bin agent-cli chat

# æµ‹è¯•æ¨¡å¼
cargo run --bin agent-cli test --message "åˆ—å‡ºå½“å‰ç›®å½•å†…å®¹"

# é™é»˜æ¨¡å¼ï¼ˆå‡å°‘æ—¥å¿—è¾“å‡ºï¼‰
cargo run --bin agent-cli chat --quiet

# æ¸…æ´æ¨¡å¼ï¼ˆå®Œå…¨éšè—æŠ€æœ¯æ—¥å¿—ï¼‰
cargo run --bin agent-cli chat --clean
```

## ğŸ¯ åŠŸèƒ½æ¼”ç¤º

### åŸºæœ¬å·¥å…·è°ƒç”¨
```bash
# åˆ—å‡ºç›®å½•å†…å®¹
cargo run --bin agent-cli test --message "åˆ—å‡ºå½“å‰ç›®å½•çš„å†…å®¹"

# è®¿é—®ç‰¹å®šç›®å½•
cargo run --bin agent-cli test --message "åˆ—å‡ºD:\\AI\\Alou2ç›®å½•çš„å†…å®¹"

# æ–‡ä»¶æ“ä½œ
cargo run --bin agent-cli test --message "è¯»å–README.mdæ–‡ä»¶çš„å†…å®¹"
```

### æ™ºèƒ½æ¨ç†å’Œé—®é¢˜è§£å†³
æ™ºèƒ½ä½“èƒ½å¤Ÿï¼š
- è‡ªåŠ¨å‘ç°ç›®å½•åç§°å¤§å°å†™é—®é¢˜
- æ™ºèƒ½æ¨èæ­£ç¡®çš„è·¯å¾„
- æä¾›æ ¼å¼åŒ–çš„è¾“å‡ºç»“æœ
- å¤„ç†å¤šæ­¥éª¤ä»»åŠ¡

### åå°åŠ è½½ä¼˜åŒ–
- å¯åŠ¨æ—¶é™é»˜åŠ è½½ MCP æœåŠ¡å™¨
- ç”¨æˆ·é¦–æ¬¡è¾“å…¥æ—¶è‡ªåŠ¨å®Œæˆå·¥å…·å‘ç°
- æ”¯æŒå¤šç§æ—¥å¿—çº§åˆ«ï¼ˆæ­£å¸¸ã€é™é»˜ã€æ¸…æ´æ¨¡å¼ï¼‰

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. MCP æœåŠ¡å™¨å¯åŠ¨å¤±è´¥
**é”™è¯¯ä¿¡æ¯**ï¼š`Failed to spawn process error=program not found`

**è§£å†³æ–¹æ¡ˆ**ï¼š
- **Windows ç”¨æˆ·**ï¼šç¡®ä¿ä½¿ç”¨ `npx.cmd` è€Œä¸æ˜¯ `npx`
- **æ£€æŸ¥ Node.js å®‰è£…**ï¼šè¿è¡Œ `node --version` å’Œ `npm --version`
- **æ£€æŸ¥ PATH ç¯å¢ƒå˜é‡**ï¼šç¡®ä¿ npm å…¨å±€åŒ…è·¯å¾„åœ¨ PATH ä¸­

#### 2. å·¥å…·è°ƒç”¨ä¸æ‰§è¡Œ
**ç—‡çŠ¶**ï¼šæ™ºèƒ½ä½“æ˜¾ç¤ºå·¥å…·è°ƒç”¨ JSON ä½†ä¸æ‰§è¡Œ

**è§£å†³æ–¹æ¡ˆ**ï¼š
- ç¡®ä¿ DeepSeek API å¯†é’¥æ­£ç¡®é…ç½®
- æ£€æŸ¥ç½‘ç»œè¿æ¥
- æŸ¥çœ‹æ—¥å¿—è¾“å‡ºä¸­çš„é”™è¯¯ä¿¡æ¯

#### 3. ç›®å½•è®¿é—®æƒé™é—®é¢˜
**é”™è¯¯ä¿¡æ¯**ï¼š`Access denied` æˆ–ç›®å½•ä¸åœ¨å…è®¸åˆ—è¡¨ä¸­

**è§£å†³æ–¹æ¡ˆ**ï¼š
- åœ¨ `mcp.json` ä¸­æ·»åŠ å…è®¸è®¿é—®çš„ç›®å½•è·¯å¾„
- ç¡®ä¿è·¯å¾„æ ¼å¼æ­£ç¡®ï¼ˆWindows ä½¿ç”¨ `\\`ï¼ŒLinux/macOS ä½¿ç”¨ `/`ï¼‰
- æ£€æŸ¥æ–‡ä»¶ç³»ç»Ÿæƒé™

#### 4. å¯åŠ¨é€Ÿåº¦æ…¢
**ç—‡çŠ¶**ï¼šåº”ç”¨å¯åŠ¨æ—¶é—´è¿‡é•¿

**è§£å†³æ–¹æ¡ˆ**ï¼š
- ä½¿ç”¨ `--quiet` æˆ– `--clean` æ¨¡å¼å‡å°‘æ—¥å¿—è¾“å‡º
- åå°åŠ è½½åŠŸèƒ½ä¼šè‡ªåŠ¨ä¼˜åŒ–å¯åŠ¨é€Ÿåº¦
- æ£€æŸ¥ç½‘ç»œè¿æ¥å’Œ MCP æœåŠ¡å™¨å“åº”æ—¶é—´

### è°ƒè¯•æ¨¡å¼

å¯ç”¨è¯¦ç»†æ—¥å¿—è¾“å‡ºï¼š
```bash
export RUST_LOG=debug
cargo run --bin agent-cli chat
```

## ğŸ“š APIæ–‡æ¡£

### æ ¸å¿ƒç±»å‹

- `McpAgent`: ä¸»è¦çš„æ™ºèƒ½ä½“å®ç°
- `AgentConfig`: æ™ºèƒ½ä½“é…ç½®ç»“æ„
- `ConnectionPool`: MCPæœåŠ¡å™¨è¿æ¥æ± 
- `WorkspaceContext`: å·¥ä½œåŒºä¸Šä¸‹æ–‡ç®¡ç†
- `ToolInfo`: å·¥å…·ä¿¡æ¯ç»“æ„

### ä¸»è¦æ–¹æ³•

- `McpAgent::new()`: åˆ›å»ºæ–°çš„æ™ºèƒ½ä½“å®ä¾‹
- `McpAgent::initialize()`: åˆå§‹åŒ–æ™ºèƒ½ä½“ï¼ˆåŒ…å«åå°MCPæœåŠ¡å™¨åŠ è½½ï¼‰
- `McpAgent::process_input()`: å¤„ç†ç”¨æˆ·è¾“å…¥ï¼ˆæ”¯æŒå·¥å…·è°ƒç”¨è§£æå’Œæ‰§è¡Œï¼‰
- `McpAgent::execute_tool()`: æ‰§è¡Œå·¥å…·è°ƒç”¨
- `McpAgent::discover_tools_silent()`: é™é»˜å‘ç°å¯ç”¨å·¥å…·
- `ConnectionPool::get_connection()`: è·å–MCPæœåŠ¡å™¨è¿æ¥
- `ConnectionPool::list_registered_servers()`: åˆ—å‡ºå·²æ³¨å†Œçš„æœåŠ¡å™¨

## Contributing

Contributions are welcome! Please open an issue or submit a PR if you have improvements, bug fixes, or new features to propose.

1. Fork the repo
2. Create a new branch
3. Add your changes and tests
4. Submit a Pull Request

Please @ darinkishore in the PR if you do send one over.

### Credits

- [MCP Rust SDK](https://github.com/Derek-X-Wang/mcp-rust-sdk)
- [AIchat](https://github.com/sigoden/aichat/tree/main)

### License

This project is licensed under the MIT License. See [LICENSE](LICENSE) for details.
