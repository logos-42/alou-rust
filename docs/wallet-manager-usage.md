# 钱包管理功能使用指南

## 概述

智能体现在具备主动管理钱包网络的能力，可以根据用户需求自动切换区块链网络。

## 快速开始

### 1. 连接钱包

首先确保你已经连接了 MetaMask 钱包：

```
访问 /login 页面 → 点击 "MetaMask" → 授权连接
```

### 2. 与智能体对话

连接钱包后，你可以直接与智能体对话，让它帮你管理钱包：

#### 查看支持的网络

```
用户: 有哪些网络可以使用？
智能体: 我们支持以下网络：
- Ethereum Sepolia (测试网)
- Base Sepolia (测试网)
- Polygon Amoy (测试网)
- Ethereum Mainnet (主网)
- Base Mainnet (主网)
- Polygon Mainnet (主网)
```

#### 切换网络

```
用户: 切换到 Base Sepolia
智能体: 好的，正在切换到 Base Sepolia...
系统: ✅ 已成功切换到 Base Sepolia (Testnet)
```

#### 查询当前网络

```
用户: 我现在在哪个网络？
智能体: 你当前连接的是 Ethereum Mainnet。
```

## 支持的命令

### 网络管理

| 用户意图 | 示例命令 | 智能体操作 |
|---------|---------|-----------|
| 列出网络 | "有哪些网络？" | 显示所有支持的网络列表 |
| 切换网络 | "切换到 Base 测试网" | 切换到指定网络 |
| 查询网络 | "我在哪个链上？" | 显示当前网络信息 |
| 查看余额 | "我的余额是多少？" | 查询当前网络的余额 |

### 智能网络选择

智能体可以根据上下文自动选择合适的网络：

```
用户: 我想在测试环境试试
智能体: 我建议使用 Base Sepolia 测试网，这是一个快速且便宜的测试环境。
      要切换到这个网络吗？
用户: 好的
智能体: [自动切换到 Base Sepolia]
```

## 技术细节

### 工作流程

1. **用户发起请求** → 在聊天界面输入命令
2. **智能体理解意图** → 分析用户需求
3. **调用钱包工具** → 使用 `wallet_manager` MCP 工具
4. **前端执行操作** → 通过 `wallet.service.ts` 与 MetaMask 交互
5. **用户确认** → 在 MetaMask 中确认操作
6. **反馈结果** → 显示操作成功或失败消息

### 网络配置

所有网络配置都在后端定义，确保前后端一致：

```rust
// alou-edge/src/mcp/tools/wallet_manager.rs
{
    "chainId": "0x14a34",
    "name": "Base Sepolia",
    "type": "Testnet",
    "rpcUrl": "https://sepolia.base.org"
}
```

### 安全机制

- ✅ 所有操作需要用户在 MetaMask 中确认
- ✅ 不存储私钥或敏感信息
- ✅ 只读取公开的地址和余额
- ✅ 网络切换失败会自动回退

## 常见问题

### Q: 为什么切换网络失败？

A: 可能的原因：
1. MetaMask 中拒绝了请求
2. 网络配置错误
3. RPC 节点不可用

解决方法：重试或手动在 MetaMask 中添加网络。

### Q: 智能体可以自动发送交易吗？

A: 不可以。智能体只能帮你切换网络和查询信息，所有交易都需要你在 MetaMask 中手动确认。

### Q: 支持其他钱包吗？

A: 目前主要支持 MetaMask，未来会支持 WalletConnect 和其他钱包。

## 示例场景

### 场景 1：DeFi 操作

```
用户: 我想在 Base 上使用 Uniswap
智能体: Base 主网是一个很好的选择，gas 费用较低。我来帮你切换。
[切换到 Base Mainnet]
智能体: 已切换到 Base 主网，你现在可以访问 Uniswap 了。
```

### 场景 2：NFT 铸造

```
用户: 我要在 Polygon 上铸造 NFT
智能体: Polygon 主网的 gas 费用很低，适合 NFT 操作。正在切换...
[切换到 Polygon Mainnet]
智能体: 已切换到 Polygon 主网，你的余额是 2.5 MATIC。
```

### 场景 3：测试开发

```
用户: 我需要测试智能合约
智能体: 建议使用 Sepolia 测试网，它是以太坊官方的测试网络。
用户: 好的，切换吧
[切换到 Ethereum Sepolia]
智能体: 已切换到 Sepolia 测试网，你可以从水龙头获取测试 ETH。
```

## 下一步

- [ ] 支持更多网络（Arbitrum, Optimism 等）
- [ ] 添加网络健康检查
- [ ] 支持自定义 RPC 节点
- [ ] 添加 gas 费用估算
- [ ] 支持多钱包管理
